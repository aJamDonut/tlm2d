import{g as N,C as r,G as w,T as i,W as An,a as T,S as Nn,b as Gn}from"./index.js";function Dn(t){var Tn,zn;if(!t)return;let x=null,d=null;try{x=N.use("get-stage")}catch{}try{d=N.use("get-renderer")}catch{}if(!x&&window.app&&window.app.stage&&(x=window.app.stage),!d&&window.app&&window.app.renderer&&(d=window.app.renderer),!x){setTimeout(()=>Dn(t),0);return}if(window.__buildablesUI&&window.__buildablesUI.root){const n=window.__buildablesUI.root;try{n.parent&&n.parent.removeChild(n)}catch{}try{n.destroy({children:!0})}catch{}window.__buildablesUI=null}const I=Array.isArray(t.items)?t.items:[],a=10,P=28,pn=28,kn=160,Ln=Math.min(10,Math.max(3,I.length)),_=22;let p=a*2+pn+8+kn+100,G=_+a+Ln*P+160;const o=new r;o.name="BuildablesUI",o.zIndex=999997,o.eventMode="static",o.cursor="default",o.on("pointerenter",()=>{window.__UI_BLOCKING=!0}),o.on("pointerleave",()=>{window.__UI_BLOCKING=!1}),o.on("pointerdown",n=>{var e;window.__UI_BLOCKING=!0,(e=n==null?void 0:n.stopPropagation)==null||e.call(n)}),o.on("pointerup",n=>{var e;(e=n==null?void 0:n.stopPropagation)==null||e.call(n)}),o.on("pointertap",n=>{var e;(e=n==null?void 0:n.stopPropagation)==null||e.call(n)});const hn=d&&d.width||1280;o.x=Math.max(14,hn-p-14),o.y=200;const D=new w;D.beginFill(658186,.86).drawRoundedRect(0,0,p,G,8).endFill(),D.lineStyle(1,2763818,1).drawRoundedRect(1.5,1.5,p-3,G-3,7),o.addChild(D);const xn=new i("BUILDABLES",{fontFamily:"Share Tech Mono, Consolas, monospace",fontSize:13,fill:16777215,stroke:0,strokeThickness:4});xn.x=a,xn.y=2;const un=new w;un.lineStyle(1,3947580,1).moveTo(0,_).lineTo(p,_),o.addChild(un);const u=new r;u.eventMode="static",u.cursor="pointer",u.x=p-98,u.y=2;const O=new w;O.beginFill(2771498,.9).drawRoundedRect(0,0,94,18,4).endFill(),O.lineStyle(1,7002474,1).drawRoundedRect(.5,.5,93,17,4),u.addChild(O);const K=new i("Build Wall",{fontFamily:"Consolas, monospace",fontSize:11,fill:15400169});K.x=8,K.y=1,u.addChild(K),u.on("pointertap",n=>{var e,l;(e=n==null?void 0:n.stopPropagation)==null||e.call(n);try{(l=t.setToolMode)==null||l.call(t,"iso-wall")}catch{}}),o.addChild(u);const y=new r;y.eventMode="static",y.cursor="pointer",y.x=p-294,y.y=2;const j=new w;j.beginFill(4860458,.9).drawRoundedRect(0,0,94,18,4).endFill(),j.lineStyle(1,16751226,1).drawRoundedRect(.5,.5,93,17,4),y.addChild(j);const V=new i("Build Arrow",{fontFamily:"Consolas, monospace",fontSize:11,fill:16771555});V.x=6,V.y=1,y.addChild(V),y.on("pointertap",n=>{var e,l;(e=n==null?void 0:n.stopPropagation)==null||e.call(n);try{(l=t.setToolMode)==null||l.call(t,"iso-arrow")}catch{}}),o.addChild(y);const s=new r;s.y=_+4,o.addChild(s);const Y=new i("Thickness (px):",{fontFamily:"Consolas, monospace",fontSize:11,fill:13160904});Y.x=a,Y.y=2,s.addChild(Y);const C=new r;C.x=a+78,C.y=0,C.eventMode="static",C.cursor="pointer";const yn=new w;yn.beginFill(2763818,.9).drawRoundedRect(0,0,18,16,3).endFill(),C.addChild(yn);const q=new i("-",{fontFamily:"Consolas",fontSize:12,fill:16777215});q.x=6,q.y=-1,C.addChild(q),s.addChild(C);const z=new i(String(t.wallThickness??20),{fontFamily:"Consolas",fontSize:12,fill:16777215});z.x=a+100,z.y=1,s.addChild(z);const g=new r;g.x=a+132,g.y=0,g.eventMode="static",g.cursor="pointer";const Cn=new w;Cn.beginFill(2763818,.9).drawRoundedRect(0,0,18,16,3).endFill(),g.addChild(Cn);const J=new i("+",{fontFamily:"Consolas",fontSize:12,fill:16777215});J.x=5,J.y=-1,g.addChild(J),s.addChild(g);const Q=new i("Color:",{fontFamily:"Consolas, monospace",fontSize:11,fill:13160904});Q.x=a,Q.y=22,s.addChild(Q);const h=document.createElement("input"),X=new i("Wallpaper:",{fontFamily:"Consolas, monospace",fontSize:11,fill:13160904});X.x=a+96,X.y=22,s.addChild(X);const f=document.createElement("select");for(const n of An.names()){const e=document.createElement("option");e.value=n,e.textContent=n,f.appendChild(e)}f.value=t.wallpaperName||((Tn=T.wallpaper)==null?void 0:Tn.name)||"brick",f.style.position="absolute",f.style.zIndex=999999,f.style.height="22px",f.style.fontFamily="Consolas, monospace",document.body.appendChild(f);const Wn=()=>{try{const n=d&&d.view&&d.view.getBoundingClientRect&&d.view.getBoundingClientRect()||window.app&&window.app.view&&window.app.view.getBoundingClientRect&&window.app.view.getBoundingClientRect()||null;if(n){const e=n.left+o.x+a+168,l=n.top+o.y+18+22;f.style.left=`${Math.round(e)}px`,f.style.top=`${Math.round(l)}px`,f.style.width="110px"}}catch{}},Z=new i("Scale:",{fontFamily:"Consolas, monospace",fontSize:11,fill:13160904});Z.x=a,Z.y=44,s.addChild(Z);const m=new r;m.x=a+52,m.y=42,m.eventMode="static",m.cursor="pointer";const gn=new w;gn.beginFill(2763818,.9).drawRoundedRect(0,0,18,16,3).endFill(),m.addChild(gn);const nn=new i("-",{fontFamily:"Consolas",fontSize:12,fill:16777215});nn.x=6,nn.y=-1,m.addChild(nn),s.addChild(m);const U=new i(String(t.wallpaperScale??((zn=T.wallpaper)==null?void 0:zn.scale)??1),{fontFamily:"Consolas",fontSize:12,fill:16777215});U.x=a+74,U.y=43,s.addChild(U);const b=new r;b.x=a+108,b.y=42,b.eventMode="static",b.cursor="pointer";const mn=new w;mn.beginFill(2763818,.9).drawRoundedRect(0,0,18,16,3).endFill(),b.addChild(mn);const en=new i("+",{fontFamily:"Consolas",fontSize:12,fill:16777215});en.x=5,en.y=-1,b.addChild(en),s.addChild(b);const S=new r;S.eventMode="static",S.cursor="pointer",S.x=p-196,S.y=2;const tn=new w;tn.beginFill(2763338,.9).drawRoundedRect(0,0,94,18,4).endFill(),tn.lineStyle(1,9216767,1).drawRoundedRect(.5,.5,93,17,4),S.addChild(tn);const on=new i("Build Door",{fontFamily:"Consolas, monospace",fontSize:11,fill:15330559});on.x=10,on.y=1,S.addChild(on),S.on("pointertap",()=>{var n;try{(n=t.setToolMode)==null||n.call(t,"iso-door")}catch{}}),o.addChild(S),h.type="color",h.value=t.wallColorHex||"#5a6a7a",h.style.position="absolute",h.style.zIndex=999999,h.style.width="38px",h.style.height="22px",document.body.appendChild(h);const Hn=()=>{try{const n=d&&d.view&&d.view.getBoundingClientRect&&d.view.getBoundingClientRect()||window.app&&window.app.view&&window.app.view.getBoundingClientRect&&window.app.view.getBoundingClientRect()||null;if(n){const e=n.left+o.x+a+52,l=n.top+o.y+18+22;h.style.left=`${Math.round(e)}px`,h.style.top=`${Math.round(l)}px`}}catch{}},k=new i("",{fontFamily:"Consolas, monospace",fontSize:11,fill:10467839});k.x=a,k.y=66,s.addChild(k);const ln=new i("Door (w x h px):",{fontFamily:"Consolas, monospace",fontSize:11,fill:13160904});ln.x=a,ln.y=84,s.addChild(ln);const bn=(n,e)=>{const l=new r,c=new w;return c.beginFill(2763818,.9).drawRoundedRect(0,0,n,e,3).endFill(),l.addChild(c),{c:l,g:c}},L=bn(44,18);L.c.x=a+118,L.c.y=82,s.addChild(L.c);const W=new i(String(t.doorWidthPx??38),{fontFamily:"Consolas",fontSize:12,fill:16777215});W.x=6,W.y=1,L.c.addChild(W);const H=bn(44,18);H.c.x=a+168,H.c.y=82,s.addChild(H.c);const $=new i(String(t.doorHeightPx??96),{fontFamily:"Consolas",fontSize:12,fill:16777215});$.x=6,$.y=1,H.c.addChild($);const F=new r;F.x=a+216,F.y=82,F.eventMode="static",F.cursor="pointer";const Sn=new w;Sn.beginFill(2763818,.9).drawRoundedRect(0,0,18,18,3).endFill(),F.addChild(Sn);const an=new i("-",{fontFamily:"Consolas",fontSize:12,fill:16777215});an.x=6,an.y=0,F.addChild(an),s.addChild(F);const R=new r;R.x=a+238,R.y=82,R.eventMode="static",R.cursor="pointer";const Fn=new w;Fn.beginFill(2763818,.9).drawRoundedRect(0,0,18,18,3).endFill(),R.addChild(Fn);const dn=new i("+",{fontFamily:"Consolas",fontSize:12,fill:16777215});dn.x=5,dn.y=0,R.addChild(dn),s.addChild(R);const v=new r;v.x=a+260,v.y=82,v.eventMode="static",v.cursor="pointer";const Rn=new w;Rn.beginFill(2763818,.9).drawRoundedRect(0,0,18,18,3).endFill(),v.addChild(Rn);const sn=new i("-",{fontFamily:"Consolas",fontSize:12,fill:16777215});sn.x=6,sn.y=0,v.addChild(sn),s.addChild(v);const M=new r;M.x=a+282,M.y=82,M.eventMode="static",M.cursor="pointer";const vn=new w;vn.beginFill(2763818,.9).drawRoundedRect(0,0,18,18,3).endFill(),M.addChild(vn);const cn=new i("+",{fontFamily:"Consolas",fontSize:12,fill:16777215});cn.x=5,cn.y=0,M.addChild(cn),s.addChild(M);const E=new r;E.y=_+100;const rn=new w;rn.beginFill(16777215,1).drawRect(0,_+92,p,G-_-94).endFill(),o.addChild(E),o.addChild(rn),E.mask=rn;const B=[],Mn={index:t.selectedItem||0};function $n(){for(;B.length<I.length;){const n=B.length,e=new r;e.y=n*P,e.eventMode="static",e.cursor="pointer";const l=new w;l.alpha=.9,e.addChild(l);let c=new Nn;c.width=22,c.height=22,c.x=a,c.y=2,e.addChild(c);const A=new i("",{fontFamily:"Consolas, monospace",fontSize:12,fill:13160904});A.x=a+pn+8,A.y=4,e.addChild(A),e.on("pointertap",()=>{var Un;try{(Un=t.setSelectedItemIndex)==null||Un.call(t,n)}catch{}Mn.index=n,wn()}),E.addChild(e),B.push({row:e,bg:l,iconSprite:c,nameText:A,idx:n})}for(let n=0;n<I.length;n++){const e=I[n]||{},l=Array.isArray(e.rotations)&&e.rotations.length?e.rotations[0]:null,c=B[n];c&&(l&&l.tex?(c.iconSprite.texture=l.tex,c.iconSprite.alpha=1):(c.iconSprite.texture=Gn.EMPTY,c.iconSprite.alpha=.6),c.nameText.text=e.codename||`item-${n+1}`,c.row.visible=!0)}for(let n=I.length;n<B.length;n++)B[n].row.visible=!1;wn()}function wn(){for(let n=0;n<I.length;n++){const e=B[n];if(!e)continue;e.bg.clear(),n===(t.selectedItem??Mn.index)?(e.bg.beginFill(2771498,.9).drawRoundedRect(2,1,p-4,P-2,4).endFill(),e.bg.lineStyle(1,7002474,1).drawRoundedRect(1.5,.5,p-3,P-1,4)):(e.bg.beginFill(1052944,.4).drawRoundedRect(2,1,p-4,P-2,4).endFill(),e.bg.lineStyle(1,2763818,1).drawRoundedRect(1.5,.5,p-3,P-1,4))}}const En=()=>{try{wn()}catch{}try{const n=d&&d.width||window.app&&window.app.renderer&&window.app.renderer.width||hn;o.x=Math.max(14,n-p-14)}catch{}Hn(),Wn();try{const n=t._dragStartCell?`${t._dragStartCell.col},${t._dragStartCell.row}`:"-",e=window.__wallPreviewEnd&&`${window.__wallPreviewEnd.col},${window.__wallPreviewEnd.row}`||"-",l=window.__wallPreviewCount||0;k.text=`start: ${n}  end: ${e}  cells: ${l}`}catch{}};$n(),N.on("tick","buildablesUIUpdate",En);try{x.sortableChildren=!0}catch{}x.addChild(o),window.__buildablesUI={root:o,stage:x};const fn=(n,e,l)=>Math.max(e,Math.min(l,n)),_n=n=>{t.wallThickness=fn(n|0,1,64),z.text=String(t.wallThickness)};C.on("pointertap",()=>_n((t.wallThickness??20)-1)),g.on("pointertap",()=>_n((t.wallThickness??20)+1)),h.onchange=()=>{t.wallColorHex=h.value},f.onchange=()=>{t.wallpaperName=f.value;try{T.wallpaper.name=f.value}catch{}};const Bn=n=>{const e=Math.max(.25,Math.min(4,Number(n)));t.wallpaperScale=e,U.text=String(e);try{T.wallpaper.scale=e}catch{}};m.on("pointertap",()=>{var n;return Bn((t.wallpaperScale??((n=T.wallpaper)==null?void 0:n.scale)??1)-.25)}),b.on("pointertap",()=>{var n;return Bn((t.wallpaperScale??((n=T.wallpaper)==null?void 0:n.scale)??1)+.25)});const In=n=>{t.doorWidthPx=fn(n|0,8,128),W.text=String(t.doorWidthPx)},Pn=n=>{t.doorHeightPx=fn(n|0,16,256),$.text=String(t.doorHeightPx)};F.on("pointertap",()=>In((t.doorWidthPx??38)-2)),R.on("pointertap",()=>In((t.doorWidthPx??38)+2)),v.on("pointertap",()=>Pn((t.doorHeightPx??96)-4)),M.on("pointertap",()=>Pn((t.doorHeightPx??96)+4)),window.__buildablesUI.cleanup=()=>{try{document.body.removeChild(h)}catch{}try{document.body.removeChild(f)}catch{}}}function Kn(){var t,x;try{N.off("tick","buildablesUIUpdate")}catch{}if(window.__buildablesUI&&window.__buildablesUI.root){const d=window.__buildablesUI.root;try{d.parent&&d.parent.removeChild(d)}catch{}try{d.destroy({children:!0})}catch{}}try{(x=(t=window.__buildablesUI).cleanup)==null||x.call(t)}catch{}window.__buildablesUI=null}export{Dn as injectBuildableUI,Kn as removeBuildableUI};
