import{g as N,l as s,C as w,G as f,T as d,W as Ae,a as T,S as Ne,b as Ge}from"./index.js";function De(t){var Pe,Te;if(!t)return;let x=null,i=null;try{x=N.use("get-stage")}catch(e){s("injectBuildableUI",e)}try{i=N.use("get-renderer")}catch(e){s("injectBuildableUI",e)}if(!x&&window.app&&window.app.stage&&(x=window.app.stage),!i&&window.app&&window.app.renderer&&(i=window.app.renderer),!x){setTimeout(()=>De(t),0);return}if(window.__buildablesUI&&window.__buildablesUI.root){const e=window.__buildablesUI.root;try{e.parent&&e.parent.removeChild(e)}catch(n){s("injectBuildableUI",n)}try{e.destroy({children:!0})}catch(n){s("injectBuildableUI",n)}window.__buildablesUI=null}const y=Array.isArray(t.items)?t.items:[],a=10,P=28,pe=28,je=160,ke=Math.min(10,Math.max(3,y.length)),M=22;let u=a*2+pe+8+je+100,G=M+a+ke*P+160;const o=new w;o.name="BuildablesUI",o.zIndex=999997,o.eventMode="static",o.cursor="default",o.on("pointerenter",()=>{window.__UI_BLOCKING=!0}),o.on("pointerleave",()=>{window.__UI_BLOCKING=!1}),o.on("pointerdown",e=>{var n;window.__UI_BLOCKING=!0,(n=e==null?void 0:e.stopPropagation)==null||n.call(e)}),o.on("pointerup",e=>{var n;(n=e==null?void 0:e.stopPropagation)==null||n.call(e)}),o.on("pointertap",e=>{var n;(n=e==null?void 0:e.stopPropagation)==null||n.call(e)});const ue=i&&i.width||1280;o.x=Math.max(14,ue-u-14),o.y=200;const D=new f;D.beginFill(658186,.86).drawRoundedRect(0,0,u,G,8).endFill(),D.lineStyle(1,2763818,1).drawRoundedRect(1.5,1.5,u-3,G-3,7),o.addChild(D);const he=new d("BUILDABLES",{fontFamily:"Share Tech Mono, Consolas, monospace",fontSize:13,fill:16777215,stroke:0,strokeThickness:4});he.x=a,he.y=2;const xe=new f;xe.lineStyle(1,3947580,1).moveTo(0,M).lineTo(u,M),o.addChild(xe);const C=new w;C.eventMode="static",C.cursor="pointer",C.x=u-98,C.y=2;const O=new f;O.beginFill(2771498,.9).drawRoundedRect(0,0,94,18,4).endFill(),O.lineStyle(1,7002474,1).drawRoundedRect(.5,.5,93,17,4),C.addChild(O);const K=new d("Build Wall",{fontFamily:"Consolas, monospace",fontSize:11,fill:15400169});K.x=8,K.y=1,C.addChild(K),C.on("pointertap",e=>{var n,l;(n=e==null?void 0:e.stopPropagation)==null||n.call(e);try{(l=t.setToolMode)==null||l.call(t,"iso-wall")}catch(c){s("injectBuildableUI",c)}}),o.addChild(C);const b=new w;b.eventMode="static",b.cursor="pointer",b.x=u-294,b.y=2;const V=new f;V.beginFill(4860458,.9).drawRoundedRect(0,0,94,18,4).endFill(),V.lineStyle(1,16751226,1).drawRoundedRect(.5,.5,93,17,4),b.addChild(V);const Y=new d("Build Arrow",{fontFamily:"Consolas, monospace",fontSize:11,fill:16771555});Y.x=6,Y.y=1,b.addChild(Y),b.on("pointertap",e=>{var n,l;(n=e==null?void 0:e.stopPropagation)==null||n.call(e);try{(l=t.setToolMode)==null||l.call(t,"iso-arrow")}catch(c){s("injectBuildableUI",c)}}),o.addChild(b);const r=new w;r.y=M+4,o.addChild(r);const q=new d("Thickness (px):",{fontFamily:"Consolas, monospace",fontSize:11,fill:13160904});q.x=a,q.y=2,r.addChild(q);const g=new w;g.x=a+78,g.y=0,g.eventMode="static",g.cursor="pointer";const ye=new f;ye.beginFill(2763818,.9).drawRoundedRect(0,0,18,16,3).endFill(),g.addChild(ye);const J=new d("-",{fontFamily:"Consolas",fontSize:12,fill:16777215});J.x=6,J.y=-1,g.addChild(J),r.addChild(g);const z=new d(String(t.wallThickness??20),{fontFamily:"Consolas",fontSize:12,fill:16777215});z.x=a+100,z.y=1,r.addChild(z);const m=new w;m.x=a+132,m.y=0,m.eventMode="static",m.cursor="pointer";const Ce=new f;Ce.beginFill(2763818,.9).drawRoundedRect(0,0,18,16,3).endFill(),m.addChild(Ce);const Q=new d("+",{fontFamily:"Consolas",fontSize:12,fill:16777215});Q.x=5,Q.y=-1,m.addChild(Q),r.addChild(m);const X=new d("Color:",{fontFamily:"Consolas, monospace",fontSize:11,fill:13160904});X.x=a,X.y=22,r.addChild(X);const h=document.createElement("input"),Z=new d("Wallpaper:",{fontFamily:"Consolas, monospace",fontSize:11,fill:13160904});Z.x=a+96,Z.y=22,r.addChild(Z);const p=document.createElement("select");for(const e of Ae.names()){const n=document.createElement("option");n.value=e,n.textContent=e,p.appendChild(n)}p.value=t.wallpaperName||((Pe=T.wallpaper)==null?void 0:Pe.name)||"brick",p.style.position="absolute",p.style.zIndex=999999,p.style.height="22px",p.style.fontFamily="Consolas, monospace",document.body.appendChild(p);const Le=()=>{try{const e=i&&i.view&&i.view.getBoundingClientRect&&i.view.getBoundingClientRect()||window.app&&window.app.view&&window.app.view.getBoundingClientRect&&window.app.view.getBoundingClientRect()||null;if(e){const n=e.left+o.x+a+168,l=e.top+o.y+18+22;p.style.left=`${Math.round(n)}px`,p.style.top=`${Math.round(l)}px`,p.style.width="110px"}}catch(e){s("injectBuildableUI",e)}},ee=new d("Scale:",{fontFamily:"Consolas, monospace",fontSize:11,fill:13160904});ee.x=a,ee.y=44,r.addChild(ee);const S=new w;S.x=a+52,S.y=42,S.eventMode="static",S.cursor="pointer";const be=new f;be.beginFill(2763818,.9).drawRoundedRect(0,0,18,16,3).endFill(),S.addChild(be);const ne=new d("-",{fontFamily:"Consolas",fontSize:12,fill:16777215});ne.x=6,ne.y=-1,S.addChild(ne),r.addChild(S);const j=new d(String(t.wallpaperScale??((Te=T.wallpaper)==null?void 0:Te.scale)??1),{fontFamily:"Consolas",fontSize:12,fill:16777215});j.x=a+74,j.y=43,r.addChild(j);const B=new w;B.x=a+108,B.y=42,B.eventMode="static",B.cursor="pointer";const ge=new f;ge.beginFill(2763818,.9).drawRoundedRect(0,0,18,16,3).endFill(),B.addChild(ge);const te=new d("+",{fontFamily:"Consolas",fontSize:12,fill:16777215});te.x=5,te.y=-1,B.addChild(te),r.addChild(B);const F=new w;F.eventMode="static",F.cursor="pointer",F.x=u-196,F.y=2;const le=new f;le.beginFill(2763338,.9).drawRoundedRect(0,0,94,18,4).endFill(),le.lineStyle(1,9216767,1).drawRoundedRect(.5,.5,93,17,4),F.addChild(le);const oe=new d("Build Door",{fontFamily:"Consolas, monospace",fontSize:11,fill:15330559});oe.x=10,oe.y=1,F.addChild(oe),F.on("pointertap",()=>{var e;try{(e=t.setToolMode)==null||e.call(t,"iso-door")}catch(n){s("injectBuildableUI",n)}}),o.addChild(F),h.type="color",h.value=t.wallColorHex||"#5a6a7a",h.style.position="absolute",h.style.zIndex=999999,h.style.width="38px",h.style.height="22px",document.body.appendChild(h);const We=()=>{try{const e=i&&i.view&&i.view.getBoundingClientRect&&i.view.getBoundingClientRect()||window.app&&window.app.view&&window.app.view.getBoundingClientRect&&window.app.view.getBoundingClientRect()||null;if(e){const n=e.left+o.x+a+52,l=e.top+o.y+18+22;h.style.left=`${Math.round(n)}px`,h.style.top=`${Math.round(l)}px`}}catch(e){s("injectBuildableUI",e)}},k=new d("",{fontFamily:"Consolas, monospace",fontSize:11,fill:10467839});k.x=a,k.y=66,r.addChild(k);const ae=new d("Door (w x h px):",{fontFamily:"Consolas, monospace",fontSize:11,fill:13160904});ae.x=a,ae.y=84,r.addChild(ae);const me=(e,n)=>{const l=new w,c=new f;return c.beginFill(2763818,.9).drawRoundedRect(0,0,e,n,3).endFill(),l.addChild(c),{c:l,g:c}},L=me(44,18);L.c.x=a+118,L.c.y=82,r.addChild(L.c);const W=new d(String(t.doorWidthPx??38),{fontFamily:"Consolas",fontSize:12,fill:16777215});W.x=6,W.y=1,L.c.addChild(W);const H=me(44,18);H.c.x=a+168,H.c.y=82,r.addChild(H.c);const $=new d(String(t.doorHeightPx??96),{fontFamily:"Consolas",fontSize:12,fill:16777215});$.x=6,$.y=1,H.c.addChild($);const I=new w;I.x=a+216,I.y=82,I.eventMode="static",I.cursor="pointer";const Se=new f;Se.beginFill(2763818,.9).drawRoundedRect(0,0,18,18,3).endFill(),I.addChild(Se);const ie=new d("-",{fontFamily:"Consolas",fontSize:12,fill:16777215});ie.x=6,ie.y=0,I.addChild(ie),r.addChild(I);const R=new w;R.x=a+238,R.y=82,R.eventMode="static",R.cursor="pointer";const Be=new f;Be.beginFill(2763818,.9).drawRoundedRect(0,0,18,18,3).endFill(),R.addChild(Be);const de=new d("+",{fontFamily:"Consolas",fontSize:12,fill:16777215});de.x=5,de.y=0,R.addChild(de),r.addChild(R);const v=new w;v.x=a+260,v.y=82,v.eventMode="static",v.cursor="pointer";const Fe=new f;Fe.beginFill(2763818,.9).drawRoundedRect(0,0,18,18,3).endFill(),v.addChild(Fe);const ce=new d("-",{fontFamily:"Consolas",fontSize:12,fill:16777215});ce.x=6,ce.y=0,v.addChild(ce),r.addChild(v);const U=new w;U.x=a+282,U.y=82,U.eventMode="static",U.cursor="pointer";const Ie=new f;Ie.beginFill(2763818,.9).drawRoundedRect(0,0,18,18,3).endFill(),U.addChild(Ie);const se=new d("+",{fontFamily:"Consolas",fontSize:12,fill:16777215});se.x=5,se.y=0,U.addChild(se),r.addChild(U);const E=new w;E.y=M+100;const re=new f;re.beginFill(16777215,1).drawRect(0,M+92,u,G-M-94).endFill(),o.addChild(E),o.addChild(re),E.mask=re;const _=[],Re={index:t.selectedItem||0};function He(){for(;_.length<y.length;){const e=_.length,n=new w;n.y=e*P,n.eventMode="static",n.cursor="pointer";const l=new f;l.alpha=.9,n.addChild(l);let c=new Ne;c.width=22,c.height=22,c.x=a,c.y=2,n.addChild(c);const A=new d("",{fontFamily:"Consolas, monospace",fontSize:12,fill:13160904});A.x=a+pe+8,A.y=4,n.addChild(A),n.on("pointertap",()=>{var ze;try{(ze=t.setSelectedItemIndex)==null||ze.call(t,e)}catch(Ee){s("injectBuildableUI",Ee)}Re.index=e,we()}),E.addChild(n),_.push({row:n,bg:l,iconSprite:c,nameText:A,idx:e})}for(let e=0;e<y.length;e++){const n=y[e]||{},l=Array.isArray(n.rotations)&&n.rotations.length?n.rotations[0]:null,c=_[e];c&&(l&&l.tex?(c.iconSprite.texture=l.tex,c.iconSprite.alpha=1):(c.iconSprite.texture=Ge.EMPTY,c.iconSprite.alpha=.6),c.nameText.text=n.codename||`item-${e+1}`,c.row.visible=!0)}for(let e=y.length;e<_.length;e++)_[e].row.visible=!1;we()}function we(){for(let e=0;e<y.length;e++){const n=_[e];if(!n)continue;n.bg.clear(),e===(t.selectedItem??Re.index)?(n.bg.beginFill(2771498,.9).drawRoundedRect(2,1,u-4,P-2,4).endFill(),n.bg.lineStyle(1,7002474,1).drawRoundedRect(1.5,.5,u-3,P-1,4)):(n.bg.beginFill(1052944,.4).drawRoundedRect(2,1,u-4,P-2,4).endFill(),n.bg.lineStyle(1,2763818,1).drawRoundedRect(1.5,.5,u-3,P-1,4))}}const $e=()=>{try{we()}catch(e){s("injectBuildableUI",e)}try{const e=i&&i.width||window.app&&window.app.renderer&&window.app.renderer.width||ue;o.x=Math.max(14,e-u-14)}catch(e){s("injectBuildableUI",e)}We(),Le();try{const e=t._dragStartCell?`${t._dragStartCell.col},${t._dragStartCell.row}`:"-",n=window.__wallPreviewEnd&&`${window.__wallPreviewEnd.col},${window.__wallPreviewEnd.row}`||"-",l=window.__wallPreviewCount||0;k.text=`start: ${e}  end: ${n}  cells: ${l}`}catch(e){s("injectBuildableUI",e)}};He(),N.on("tick","buildablesUIUpdate",$e);try{x.sortableChildren=!0}catch(e){s("injectBuildableUI",e)}x.addChild(o),window.__buildablesUI={root:o,stage:x};const fe=(e,n,l)=>Math.max(n,Math.min(l,e)),ve=e=>{t.wallThickness=fe(e|0,1,64),z.text=String(t.wallThickness)};g.on("pointertap",()=>ve((t.wallThickness??20)-1)),m.on("pointertap",()=>ve((t.wallThickness??20)+1)),h.onchange=()=>{t.wallColorHex=h.value},p.onchange=()=>{t.wallpaperName=p.value;try{T.wallpaper.name=p.value}catch(e){s("injectBuildableUI",e)}};const Ue=e=>{const n=Math.max(.25,Math.min(4,Number(e)));t.wallpaperScale=n,j.text=String(n);try{T.wallpaper.scale=n}catch(l){s("injectBuildableUI",l)}};S.on("pointertap",()=>{var e;return Ue((t.wallpaperScale??((e=T.wallpaper)==null?void 0:e.scale)??1)-.25)}),B.on("pointertap",()=>{var e;return Ue((t.wallpaperScale??((e=T.wallpaper)==null?void 0:e.scale)??1)+.25)});const Me=e=>{t.doorWidthPx=fe(e|0,8,128),W.text=String(t.doorWidthPx)},_e=e=>{t.doorHeightPx=fe(e|0,16,256),$.text=String(t.doorHeightPx)};I.on("pointertap",()=>Me((t.doorWidthPx??38)-2)),R.on("pointertap",()=>Me((t.doorWidthPx??38)+2)),v.on("pointertap",()=>_e((t.doorHeightPx??96)-4)),U.on("pointertap",()=>_e((t.doorHeightPx??96)+4)),window.__buildablesUI.cleanup=()=>{try{document.body.removeChild(h)}catch(e){s("injectBuildableUI",e)}try{document.body.removeChild(p)}catch(e){s("injectBuildableUI",e)}}}function Ke(){var t,x;try{N.off("tick","buildablesUIUpdate")}catch(i){s("injectBuildableUI",i)}if(window.__buildablesUI&&window.__buildablesUI.root){const i=window.__buildablesUI.root;try{i.parent&&i.parent.removeChild(i)}catch(y){s("injectBuildableUI",y)}try{i.destroy({children:!0})}catch(y){s("injectBuildableUI",y)}}try{(x=(t=window.__buildablesUI).cleanup)==null||x.call(t)}catch(i){s("injectBuildableUI",i)}window.__buildablesUI=null}export{De as injectBuildableUI,Ke as removeBuildableUI};
