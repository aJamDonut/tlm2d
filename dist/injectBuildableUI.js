import{g as D,C as r,G as w,T as o,W as Ee,a as P,S as Ae,b as De}from"./index.js";function Ne(n){var Ie,Pe;if(!n)return;let x=null,i=null;try{x=D.use("get-stage")}catch{}try{i=D.use("get-renderer")}catch{}if(!x&&window.app&&window.app.stage&&(x=window.app.stage),!i&&window.app&&window.app.renderer&&(i=window.app.renderer),!x){setTimeout(()=>Ne(n),0);return}if(window.__buildablesUI&&window.__buildablesUI.root){const e=window.__buildablesUI.root;try{e.parent&&e.parent.removeChild(e)}catch{}try{e.destroy({children:!0})}catch{}window.__buildablesUI=null}const T=Array.isArray(n.items)?n.items:[],l=10,I=28,fe=28,Ue=160,ke=Math.min(10,Math.max(3,T.length)),B=22;let p=l*2+fe+8+Ue+100,N=B+l+ke*I+160;const a=new r;a.name="BuildablesUI",a.zIndex=999997,a.eventMode="static",a.cursor="default";const pe=i&&i.width||1280;a.x=Math.max(14,pe-p-14),a.y=200;const G=new w;G.beginFill(658186,.86).drawRoundedRect(0,0,p,N,8).endFill(),G.lineStyle(1,2763818,1).drawRoundedRect(1.5,1.5,p-3,N-3,7),a.addChild(G);const he=new o("BUILDABLES",{fontFamily:"Share Tech Mono, Consolas, monospace",fontSize:13,fill:16777215,stroke:0,strokeThickness:4});he.x=l,he.y=2;const xe=new w;xe.lineStyle(1,3947580,1).moveTo(0,B).lineTo(p,B),a.addChild(xe);const u=new r;u.eventMode="static",u.cursor="pointer",u.x=p-98,u.y=2;const j=new w;j.beginFill(2771498,.9).drawRoundedRect(0,0,94,18,4).endFill(),j.lineStyle(1,7002474,1).drawRoundedRect(.5,.5,93,17,4),u.addChild(j);const V=new o("Build Wall",{fontFamily:"Consolas, monospace",fontSize:11,fill:15400169});V.x=8,V.y=1,u.addChild(V),u.on("pointertap",()=>{var e;try{(e=n.setToolMode)==null||e.call(n,"iso-wall")}catch{}}),a.addChild(u);const y=new r;y.eventMode="static",y.cursor="pointer",y.x=p-294,y.y=2;const O=new w;O.beginFill(4860458,.9).drawRoundedRect(0,0,94,18,4).endFill(),O.lineStyle(1,16751226,1).drawRoundedRect(.5,.5,93,17,4),y.addChild(O);const Y=new o("Build Arrow",{fontFamily:"Consolas, monospace",fontSize:11,fill:16771555});Y.x=6,Y.y=1,y.addChild(Y),y.on("pointertap",()=>{var e;try{(e=n.setToolMode)==null||e.call(n,"iso-arrow")}catch{}}),a.addChild(y);const d=new r;d.y=B+4,a.addChild(d);const q=new o("Thickness (px):",{fontFamily:"Consolas, monospace",fontSize:11,fill:13160904});q.x=l,q.y=2,d.addChild(q);const C=new r;C.x=l+78,C.y=0,C.eventMode="static",C.cursor="pointer";const ue=new w;ue.beginFill(2763818,.9).drawRoundedRect(0,0,18,16,3).endFill(),C.addChild(ue);const J=new o("-",{fontFamily:"Consolas",fontSize:12,fill:16777215});J.x=6,J.y=-1,C.addChild(J),d.addChild(C);const z=new o(String(n.wallThickness??20),{fontFamily:"Consolas",fontSize:12,fill:16777215});z.x=l+100,z.y=1,d.addChild(z);const g=new r;g.x=l+132,g.y=0,g.eventMode="static",g.cursor="pointer";const ye=new w;ye.beginFill(2763818,.9).drawRoundedRect(0,0,18,16,3).endFill(),g.addChild(ye);const K=new o("+",{fontFamily:"Consolas",fontSize:12,fill:16777215});K.x=5,K.y=-1,g.addChild(K),d.addChild(g);const Q=new o("Color:",{fontFamily:"Consolas, monospace",fontSize:11,fill:13160904});Q.x=l,Q.y=22,d.addChild(Q);const h=document.createElement("input"),X=new o("Wallpaper:",{fontFamily:"Consolas, monospace",fontSize:11,fill:13160904});X.x=l+96,X.y=22,d.addChild(X);const f=document.createElement("select");for(const e of Ee.names()){const t=document.createElement("option");t.value=e,t.textContent=e,f.appendChild(t)}f.value=n.wallpaperName||((Ie=P.wallpaper)==null?void 0:Ie.name)||"brick",f.style.position="absolute",f.style.zIndex=999999,f.style.height="22px",f.style.fontFamily="Consolas, monospace",document.body.appendChild(f);const Le=()=>{try{const e=i&&i.view&&i.view.getBoundingClientRect&&i.view.getBoundingClientRect()||window.app&&window.app.view&&window.app.view.getBoundingClientRect&&window.app.view.getBoundingClientRect()||null;if(e){const t=e.left+a.x+l+168,s=e.top+a.y+18+22;f.style.left=`${Math.round(t)}px`,f.style.top=`${Math.round(s)}px`,f.style.width="110px"}}catch{}},Z=new o("Scale:",{fontFamily:"Consolas, monospace",fontSize:11,fill:13160904});Z.x=l,Z.y=44,d.addChild(Z);const m=new r;m.x=l+52,m.y=42,m.eventMode="static",m.cursor="pointer";const Ce=new w;Ce.beginFill(2763818,.9).drawRoundedRect(0,0,18,16,3).endFill(),m.addChild(Ce);const ee=new o("-",{fontFamily:"Consolas",fontSize:12,fill:16777215});ee.x=6,ee.y=-1,m.addChild(ee),d.addChild(m);const U=new o(String(n.wallpaperScale??((Pe=P.wallpaper)==null?void 0:Pe.scale)??1),{fontFamily:"Consolas",fontSize:12,fill:16777215});U.x=l+74,U.y=43,d.addChild(U);const b=new r;b.x=l+108,b.y=42,b.eventMode="static",b.cursor="pointer";const ge=new w;ge.beginFill(2763818,.9).drawRoundedRect(0,0,18,16,3).endFill(),b.addChild(ge);const ne=new o("+",{fontFamily:"Consolas",fontSize:12,fill:16777215});ne.x=5,ne.y=-1,b.addChild(ne),d.addChild(b);const S=new r;S.eventMode="static",S.cursor="pointer",S.x=p-196,S.y=2;const te=new w;te.beginFill(2763338,.9).drawRoundedRect(0,0,94,18,4).endFill(),te.lineStyle(1,9216767,1).drawRoundedRect(.5,.5,93,17,4),S.addChild(te);const le=new o("Build Door",{fontFamily:"Consolas, monospace",fontSize:11,fill:15330559});le.x=10,le.y=1,S.addChild(le),S.on("pointertap",()=>{var e;try{(e=n.setToolMode)==null||e.call(n,"iso-door")}catch{}}),a.addChild(S),h.type="color",h.value=n.wallColorHex||"#5a6a7a",h.style.position="absolute",h.style.zIndex=999999,h.style.width="38px",h.style.height="22px",document.body.appendChild(h);const We=()=>{try{const e=i&&i.view&&i.view.getBoundingClientRect&&i.view.getBoundingClientRect()||window.app&&window.app.view&&window.app.view.getBoundingClientRect&&window.app.view.getBoundingClientRect()||null;if(e){const t=e.left+a.x+l+52,s=e.top+a.y+18+22;h.style.left=`${Math.round(t)}px`,h.style.top=`${Math.round(s)}px`}}catch{}},k=new o("",{fontFamily:"Consolas, monospace",fontSize:11,fill:10467839});k.x=l,k.y=66,d.addChild(k);const oe=new o("Door (w x h px):",{fontFamily:"Consolas, monospace",fontSize:11,fill:13160904});oe.x=l,oe.y=84,d.addChild(oe);const me=(e,t)=>{const s=new r,c=new w;return c.beginFill(2763818,.9).drawRoundedRect(0,0,e,t,3).endFill(),s.addChild(c),{c:s,g:c}},L=me(44,18);L.c.x=l+118,L.c.y=82,d.addChild(L.c);const W=new o(String(n.doorWidthPx??38),{fontFamily:"Consolas",fontSize:12,fill:16777215});W.x=6,W.y=1,L.c.addChild(W);const H=me(44,18);H.c.x=l+168,H.c.y=82,d.addChild(H.c);const $=new o(String(n.doorHeightPx??96),{fontFamily:"Consolas",fontSize:12,fill:16777215});$.x=6,$.y=1,H.c.addChild($);const F=new r;F.x=l+216,F.y=82,F.eventMode="static",F.cursor="pointer";const be=new w;be.beginFill(2763818,.9).drawRoundedRect(0,0,18,18,3).endFill(),F.addChild(be);const ae=new o("-",{fontFamily:"Consolas",fontSize:12,fill:16777215});ae.x=6,ae.y=0,F.addChild(ae),d.addChild(F);const R=new r;R.x=l+238,R.y=82,R.eventMode="static",R.cursor="pointer";const Se=new w;Se.beginFill(2763818,.9).drawRoundedRect(0,0,18,18,3).endFill(),R.addChild(Se);const ie=new o("+",{fontFamily:"Consolas",fontSize:12,fill:16777215});ie.x=5,ie.y=0,R.addChild(ie),d.addChild(R);const v=new r;v.x=l+260,v.y=82,v.eventMode="static",v.cursor="pointer";const Fe=new w;Fe.beginFill(2763818,.9).drawRoundedRect(0,0,18,18,3).endFill(),v.addChild(Fe);const de=new o("-",{fontFamily:"Consolas",fontSize:12,fill:16777215});de.x=6,de.y=0,v.addChild(de),d.addChild(v);const M=new r;M.x=l+282,M.y=82,M.eventMode="static",M.cursor="pointer";const Re=new w;Re.beginFill(2763818,.9).drawRoundedRect(0,0,18,18,3).endFill(),M.addChild(Re);const se=new o("+",{fontFamily:"Consolas",fontSize:12,fill:16777215});se.x=5,se.y=0,M.addChild(se),d.addChild(M);const E=new r;E.y=B+100;const ce=new w;ce.beginFill(16777215,1).drawRect(0,B+92,p,N-B-94).endFill(),a.addChild(E),a.addChild(ce),E.mask=ce;const _=[],ve={index:n.selectedItem||0};function He(){for(;_.length<T.length;){const e=_.length,t=new r;t.y=e*I,t.eventMode="static",t.cursor="pointer";const s=new w;s.alpha=.9,t.addChild(s);let c=new Ae;c.width=22,c.height=22,c.x=l,c.y=2,t.addChild(c);const A=new o("",{fontFamily:"Consolas, monospace",fontSize:12,fill:13160904});A.x=l+fe+8,A.y=4,t.addChild(A),t.on("pointertap",()=>{var ze;try{(ze=n.setSelectedItemIndex)==null||ze.call(n,e)}catch{}ve.index=e,re()}),E.addChild(t),_.push({row:t,bg:s,iconSprite:c,nameText:A,idx:e})}for(let e=0;e<T.length;e++){const t=T[e]||{},s=Array.isArray(t.rotations)&&t.rotations.length?t.rotations[0]:null,c=_[e];c&&(s&&s.tex?(c.iconSprite.texture=s.tex,c.iconSprite.alpha=1):(c.iconSprite.texture=De.EMPTY,c.iconSprite.alpha=.6),c.nameText.text=t.codename||`item-${e+1}`,c.row.visible=!0)}for(let e=T.length;e<_.length;e++)_[e].row.visible=!1;re()}function re(){for(let e=0;e<T.length;e++){const t=_[e];if(!t)continue;t.bg.clear(),e===(n.selectedItem??ve.index)?(t.bg.beginFill(2771498,.9).drawRoundedRect(2,1,p-4,I-2,4).endFill(),t.bg.lineStyle(1,7002474,1).drawRoundedRect(1.5,.5,p-3,I-1,4)):(t.bg.beginFill(1052944,.4).drawRoundedRect(2,1,p-4,I-2,4).endFill(),t.bg.lineStyle(1,2763818,1).drawRoundedRect(1.5,.5,p-3,I-1,4))}}const $e=()=>{try{re()}catch{}try{const e=i&&i.width||window.app&&window.app.renderer&&window.app.renderer.width||pe;a.x=Math.max(14,e-p-14)}catch{}We(),Le();try{const e=n._dragStartCell?`${n._dragStartCell.col},${n._dragStartCell.row}`:"-",t=window.__wallPreviewEnd&&`${window.__wallPreviewEnd.col},${window.__wallPreviewEnd.row}`||"-",s=window.__wallPreviewCount||0;k.text=`start: ${e}  end: ${t}  cells: ${s}`}catch{}};He(),D.on("tick","buildablesUIUpdate",$e);try{x.sortableChildren=!0}catch{}x.addChild(a),window.__buildablesUI={root:a,stage:x};const we=(e,t,s)=>Math.max(t,Math.min(s,e)),Me=e=>{n.wallThickness=we(e|0,1,64),z.text=String(n.wallThickness)};C.on("pointertap",()=>Me((n.wallThickness??20)-1)),g.on("pointertap",()=>Me((n.wallThickness??20)+1)),h.onchange=()=>{n.wallColorHex=h.value},f.onchange=()=>{n.wallpaperName=f.value;try{P.wallpaper.name=f.value}catch{}};const Be=e=>{const t=Math.max(.25,Math.min(4,Number(e)));n.wallpaperScale=t,U.text=String(t);try{P.wallpaper.scale=t}catch{}};m.on("pointertap",()=>{var e;return Be((n.wallpaperScale??((e=P.wallpaper)==null?void 0:e.scale)??1)-.25)}),b.on("pointertap",()=>{var e;return Be((n.wallpaperScale??((e=P.wallpaper)==null?void 0:e.scale)??1)+.25)});const _e=e=>{n.doorWidthPx=we(e|0,8,128),W.text=String(n.doorWidthPx)},Te=e=>{n.doorHeightPx=we(e|0,16,256),$.text=String(n.doorHeightPx)};F.on("pointertap",()=>_e((n.doorWidthPx??38)-2)),R.on("pointertap",()=>_e((n.doorWidthPx??38)+2)),v.on("pointertap",()=>Te((n.doorHeightPx??96)-4)),M.on("pointertap",()=>Te((n.doorHeightPx??96)+4)),window.__buildablesUI.cleanup=()=>{try{document.body.removeChild(h)}catch{}try{document.body.removeChild(f)}catch{}}}function je(){var n,x;try{D.off("tick","buildablesUIUpdate")}catch{}if(window.__buildablesUI&&window.__buildablesUI.root){const i=window.__buildablesUI.root;try{i.parent&&i.parent.removeChild(i)}catch{}try{i.destroy({children:!0})}catch{}}try{(x=(n=window.__buildablesUI).cleanup)==null||x.call(n)}catch{}window.__buildablesUI=null}export{Ne as injectBuildableUI,je as removeBuildableUI};
